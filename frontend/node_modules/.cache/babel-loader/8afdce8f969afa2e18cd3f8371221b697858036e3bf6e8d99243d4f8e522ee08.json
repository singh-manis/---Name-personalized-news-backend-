{"ast":null,"code":"import _objectSpread from\"C:/Users/Manish singh/Desktop/personalized-news/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{useParams,useNavigate}from'react-router-dom';import axios from'axios';import{toast}from'react-toastify';import{BookmarkIcon,ChatBubbleLeftIcon,ArrowLeftIcon,MicrophoneIcon,SpeakerWaveIcon,XMarkIcon,UserIcon,GlobeAltIcon,CheckBadgeIcon}from'@heroicons/react/24/outline';import{useTranslation}from'react-i18next';import ReactMarkdown from'react-markdown';import'./HomeModern.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function Article(){const{id}=useParams();const navigate=useNavigate();const[article,setArticle]=useState(null);const[loading,setLoading]=useState(true);const[question,setQuestion]=useState('');const[answer,setAnswer]=useState('');const[aiLoading,setAiLoading]=useState(false);const[complexity,setComplexity]=useState('intermediate');const[explanation,setExplanation]=useState('');const[commentText,setCommentText]=useState('');const[submittingComment,setSubmittingComment]=useState(false);const[translatedContent,setTranslatedContent]=useState('');const[translating,setTranslating]=useState(false);const[targetLang,setTargetLang]=useState('hi');const[translatedTitle,setTranslatedTitle]=useState('');const[translatingTitle,setTranslatingTitle]=useState(false);const[translatedComments,setTranslatedComments]=useState({});const[translatingComments,setTranslatingComments]=useState({});const[commentsSummary,setCommentsSummary]=useState('');const[summarizingComments,setSummarizingComments]=useState(false);const[factCheckResult,setFactCheckResult]=useState(null);const[factChecking,setFactChecking]=useState(false);const{t}=useTranslation();useEffect(()=>{fetchArticle();},[id]);const fetchArticle=async()=>{try{const token=localStorage.getItem('token');const res=await axios.get(\"\".concat(process.env.REACT_APP_API_URL,\"/api/news/article/\").concat(id),{headers:{'x-auth-token':token}});setArticle(res.data);setLoading(false);}catch(err){toast.error('Failed to fetch article');setLoading(false);}};const handleSaveArticle=async()=>{try{const token=localStorage.getItem('token');await axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/news/article/\").concat(id,\"/save\"),{},{headers:{'x-auth-token':token}});toast.success('Article saved successfully');}catch(err){toast.error('Failed to save article');}};const handleAskQuestion=async e=>{e.preventDefault();if(!question.trim())return;setAiLoading(true);try{var _res$data$candidates,_res$data$candidates$,_res$data$candidates$2,_res$data$candidates$3,_res$data$candidates$4;const token=localStorage.getItem('token');const res=await axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/ai/qa\"),{question,context:article.content},{headers:{'x-auth-token':token}});setAnswer(res.data.answer||((_res$data$candidates=res.data.candidates)===null||_res$data$candidates===void 0?void 0:(_res$data$candidates$=_res$data$candidates[0])===null||_res$data$candidates$===void 0?void 0:(_res$data$candidates$2=_res$data$candidates$.content)===null||_res$data$candidates$2===void 0?void 0:(_res$data$candidates$3=_res$data$candidates$2.parts)===null||_res$data$candidates$3===void 0?void 0:(_res$data$candidates$4=_res$data$candidates$3[0])===null||_res$data$candidates$4===void 0?void 0:_res$data$candidates$4.text)||'');}catch(err){var _err$response,_err$response$data,_err$response2,_err$response2$data;toast.error(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.msg)||((_err$response2=err.response)===null||_err$response2===void 0?void 0:(_err$response2$data=_err$response2.data)===null||_err$response2$data===void 0?void 0:_err$response2$data.error)||'Failed to get answer');}finally{setAiLoading(false);}};const handleExplain=async()=>{if(!(article!==null&&article!==void 0&&article.title)||!complexity){toast.error('Please select an article and explanation level.');return;}try{var _res$data$candidates2,_res$data$candidates3,_res$data$candidates4,_res$data$candidates5,_res$data$candidates6;const token=localStorage.getItem('token');const res=await axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/ai/explain\"),{question:\"\".concat(article.title,\" (\").concat(complexity,\")\")},{headers:{'x-auth-token':token}});console.log('AI explain response:',res.data);// Try direct explanation, then Gemini nested structure\nsetExplanation(res.data.explanation||((_res$data$candidates2=res.data.candidates)===null||_res$data$candidates2===void 0?void 0:(_res$data$candidates3=_res$data$candidates2[0])===null||_res$data$candidates3===void 0?void 0:(_res$data$candidates4=_res$data$candidates3.content)===null||_res$data$candidates4===void 0?void 0:(_res$data$candidates5=_res$data$candidates4.parts)===null||_res$data$candidates5===void 0?void 0:(_res$data$candidates6=_res$data$candidates5[0])===null||_res$data$candidates6===void 0?void 0:_res$data$candidates6.text)||'');}catch(err){var _err$response3,_err$response3$data,_err$response4,_err$response4$data;toast.error(((_err$response3=err.response)===null||_err$response3===void 0?void 0:(_err$response3$data=_err$response3.data)===null||_err$response3$data===void 0?void 0:_err$response3$data.msg)||((_err$response4=err.response)===null||_err$response4===void 0?void 0:(_err$response4$data=_err$response4.data)===null||_err$response4$data===void 0?void 0:_err$response4$data.error)||'Failed to get explanation');}};const handleVoiceInput=()=>{if(!('webkitSpeechRecognition'in window)){alert('Speech recognition not supported in this browser.');return;}const recognition=new window.webkitSpeechRecognition();recognition.lang='en-US';recognition.interimResults=false;recognition.maxAlternatives=1;recognition.onresult=event=>{const transcript=event.results[0][0].transcript;setQuestion(transcript);};recognition.start();};const handleSpeak=text=>{if('speechSynthesis'in window){const utterance=new window.SpeechSynthesisUtterance(text);window.speechSynthesis.speak(utterance);}else{alert('Text-to-speech not supported in this browser.');}};const handleAddComment=async e=>{e.preventDefault();if(!commentText.trim())return;setSubmittingComment(true);try{const token=localStorage.getItem('token');const res=await axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/news/article/\").concat(id,\"/comment\"),{content:commentText},{headers:{'x-auth-token':token}});setArticle(prev=>_objectSpread(_objectSpread({},prev),{},{comments:res.data}));setCommentText('');}catch(err){toast.error('Failed to add comment');}finally{setSubmittingComment(false);}};const handleTranslate=async()=>{if(!(article!==null&&article!==void 0&&article.content))return;setTranslating(true);setTranslatedContent('');try{const token=localStorage.getItem('token');const res=await axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/ai/translate\"),{text:article.content,targetLang},{headers:{'x-auth-token':token}});setTranslatedContent(res.data.translation);}catch(err){var _err$response5,_err$response5$data,_err$response6,_err$response6$data;toast.error(((_err$response5=err.response)===null||_err$response5===void 0?void 0:(_err$response5$data=_err$response5.data)===null||_err$response5$data===void 0?void 0:_err$response5$data.msg)||((_err$response6=err.response)===null||_err$response6===void 0?void 0:(_err$response6$data=_err$response6.data)===null||_err$response6$data===void 0?void 0:_err$response6$data.error)||'Translation failed');}finally{setTranslating(false);}};const handleTranslateTitle=async()=>{if(!(article!==null&&article!==void 0&&article.title))return;setTranslatingTitle(true);setTranslatedTitle('');try{const token=localStorage.getItem('token');const res=await axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/ai/translate\"),{text:article.title,targetLang},{headers:{'x-auth-token':token}});setTranslatedTitle(res.data.translation);}catch(err){var _err$response7,_err$response7$data,_err$response8,_err$response8$data;toast.error(((_err$response7=err.response)===null||_err$response7===void 0?void 0:(_err$response7$data=_err$response7.data)===null||_err$response7$data===void 0?void 0:_err$response7$data.msg)||((_err$response8=err.response)===null||_err$response8===void 0?void 0:(_err$response8$data=_err$response8.data)===null||_err$response8$data===void 0?void 0:_err$response8$data.error)||'Translation failed');}finally{setTranslatingTitle(false);}};const handleTranslateComment=async(commentId,text)=>{setTranslatingComments(prev=>_objectSpread(_objectSpread({},prev),{},{[commentId]:true}));setTranslatedComments(prev=>_objectSpread(_objectSpread({},prev),{},{[commentId]:''}));try{const token=localStorage.getItem('token');const res=await axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/ai/translate\"),{text,targetLang},{headers:{'x-auth-token':token}});setTranslatedComments(prev=>_objectSpread(_objectSpread({},prev),{},{[commentId]:res.data.translation}));}catch(err){var _err$response9,_err$response9$data,_err$response0,_err$response0$data;toast.error(((_err$response9=err.response)===null||_err$response9===void 0?void 0:(_err$response9$data=_err$response9.data)===null||_err$response9$data===void 0?void 0:_err$response9$data.msg)||((_err$response0=err.response)===null||_err$response0===void 0?void 0:(_err$response0$data=_err$response0.data)===null||_err$response0$data===void 0?void 0:_err$response0$data.error)||'Translation failed');}finally{setTranslatingComments(prev=>_objectSpread(_objectSpread({},prev),{},{[commentId]:false}));}};const handleSummarizeComments=async()=>{if(!(article!==null&&article!==void 0&&article.comments)||article.comments.length===0)return;setSummarizingComments(true);setCommentsSummary('');try{const token=localStorage.getItem('token');const commentsArr=article.comments.map(c=>c.content);const res=await axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/ai/summarize-comments\"),{comments:commentsArr},{headers:{'x-auth-token':token}});setCommentsSummary(res.data.summary);}catch(err){var _err$response1,_err$response1$data,_err$response10,_err$response10$data;toast.error(((_err$response1=err.response)===null||_err$response1===void 0?void 0:(_err$response1$data=_err$response1.data)===null||_err$response1$data===void 0?void 0:_err$response1$data.msg)||((_err$response10=err.response)===null||_err$response10===void 0?void 0:(_err$response10$data=_err$response10.data)===null||_err$response10$data===void 0?void 0:_err$response10$data.error)||'Failed to summarize comments');}finally{setSummarizingComments(false);}};const handleFactCheck=async()=>{if(!(article!==null&&article!==void 0&&article.content))return;setFactChecking(true);setFactCheckResult(null);try{const token=localStorage.getItem('token');const res=await axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/ai/fact-check\"),{content:article.content},{headers:{'x-auth-token':token}});setFactCheckResult(res.data);}catch(err){var _err$response11,_err$response11$data,_err$response12,_err$response12$data;toast.error(((_err$response11=err.response)===null||_err$response11===void 0?void 0:(_err$response11$data=_err$response11.data)===null||_err$response11$data===void 0?void 0:_err$response11$data.msg)||((_err$response12=err.response)===null||_err$response12===void 0?void 0:(_err$response12$data=_err$response12.data)===null||_err$response12$data===void 0?void 0:_err$response12$data.error)||'Fact-check failed');}finally{setFactChecking(false);}};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center items-center h-64\",children:/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600\"})});}if(!article){return/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-12\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900\",children:t('Article not found')}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>navigate('/'),className:\"mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700\",children:[/*#__PURE__*/_jsx(ArrowLeftIcon,{className:\"h-5 w-5 mr-2\"}),t('Back to Home')]})]});}return/*#__PURE__*/_jsx(\"div\",{className:\"modern-bg min-h-screen py-8\",children:/*#__PURE__*/_jsx(\"div\",{className:\"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl shadow-2xl p-8 sm:p-10 border border-gray-100\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>navigate(-1),className:\"inline-flex items-center text-gray-600 hover:text-primary-700 mb-6 font-semibold\",children:[/*#__PURE__*/_jsx(ArrowLeftIcon,{className:\"h-5 w-5 mr-2\"}),\"Back\"]}),article.imageUrl&&/*#__PURE__*/_jsx(\"img\",{src:article.imageUrl,alt:article.title,className:\"w-full h-auto max-h-80 object-cover rounded-xl mb-6 shadow-lg\"}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-extrabold text-primary-700 mb-4 tracking-tight drop-shadow\",children:article.title}),/*#__PURE__*/_jsx(\"div\",{className:\"prose prose-lg max-w-none text-gray-800 mb-6\",children:/*#__PURE__*/_jsx(\"p\",{children:article.content})}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-10 pt-8 border-t border-gray-200\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-8\",children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"text-xl font-bold text-primary-700 mb-4 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(ChatBubbleLeftIcon,{className:\"h-6 w-6\"}),\" AI Assistant\"]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleAskQuestion,className:\"flex flex-col gap-3 mb-3\",children:[/*#__PURE__*/_jsx(\"textarea\",{className:\"rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500 w-full\",rows:2,value:question,onChange:e=>setQuestion(e.target.value),placeholder:\"Ask a question about this article...\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"px-4 py-2 rounded-md bg-primary-600 text-white font-medium hover:bg-primary-700 w-fit self-start\",disabled:aiLoading,children:aiLoading?'Asking...':'Ask AI'})]}),answer&&/*#__PURE__*/_jsx(\"div\",{className:\"prose prose-lg max-w-none bg-blue-50 rounded-lg p-4 text-blue-900 mb-4\",children:/*#__PURE__*/_jsx(ReactMarkdown,{children:answer})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-8\",children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"text-xl font-bold text-primary-700 mb-4 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(CheckBadgeIcon,{className:\"h-6 w-6\"}),\" Fact-Check\"]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleFactCheck,className:\"px-4 py-2 rounded-md bg-green-100 text-green-800 font-semibold hover:bg-green-200 flex items-center gap-2\",disabled:factChecking,children:factChecking?'Fact-checking...':/*#__PURE__*/_jsx(_Fragment,{children:\"Fact-Check this Article\"})}),factCheckResult&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 bg-gray-50 rounded-lg p-4 border border-gray-200\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-bold text-gray-800 mb-2\",children:\"Fact-Check Result\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold text-gray-700\",children:\"Verdict: \"}),/*#__PURE__*/_jsx(\"span\",{className:\"px-2 py-1 text-sm font-bold rounded-full \".concat({\"Accurate\":\"bg-green-100 text-green-800\",\"Mostly Accurate\":\"bg-green-100 text-green-800\",\"Mixed\":\"bg-yellow-100 text-yellow-800\",\"Mostly Inaccurate\":\"bg-red-100 text-red-800\",\"Inaccurate\":\"bg-red-100 text-red-800\",\"Unverifiable\":\"bg-gray-100 text-gray-800\",\"Parsing Failed\":\"bg-red-100 text-red-800\"}[factCheckResult.verdict]||'bg-gray-100 text-gray-800'),children:factCheckResult.verdict})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-700 mb-4 italic\",children:[\"\\\"\",factCheckResult.summary,\"\\\"\"]}),factCheckResult.claims&&factCheckResult.claims.length>0&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-bold text-gray-700 mb-2\",children:\"Detailed Claims Analysis:\"}),/*#__PURE__*/_jsx(\"ul\",{className:\"space-y-3\",children:factCheckResult.claims.map((item,index)=>/*#__PURE__*/_jsxs(\"li\",{className:\"border-l-4 p-3 rounded-r-lg \".concat({\"Accurate\":\"border-green-500 bg-green-50\",\"Inaccurate\":\"border-red-500 bg-red-50\",\"Unverifiable\":\"border-gray-400 bg-gray-100\",\"Error\":\"border-red-500 bg-red-50\"}[item.verdict]||'border-gray-400 bg-gray-100'),children:[/*#__PURE__*/_jsxs(\"p\",{className:\"font-semibold text-gray-800\",children:[\"Claim: \",/*#__PURE__*/_jsxs(\"span\",{className:\"font-normal\",children:[\"\\\"\",item.claim,\"\\\"\"]})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-700 mt-1\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Evaluation:\"}),\" \",item.evaluation]})]},index))})]})]})]})]})]})})});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}