{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useLocation,useNavigate}from'react-router-dom';import axios from'axios';import{toast}from'react-toastify';import{HeartIcon,BookmarkIcon,ChatBubbleLeftEllipsisIcon,ArrowLeftIcon,GlobeAltIcon,CheckBadgeIcon}from'@heroicons/react/24/outline';import ReactMarkdown from'react-markdown';import'./HomeModern.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function ExternalArticle(){var _article$source2;const{state}=useLocation();const article=state===null||state===void 0?void 0:state.article;const navigate=useNavigate();const[question,setQuestion]=useState('');const[answer,setAnswer]=useState('');const[aiLoading,setAiLoading]=useState(false);const[factCheckResult,setFactCheckResult]=useState(null);const[factChecking,setFactChecking]=useState(false);const[translated,setTranslated]=useState('');const[translating,setTranslating]=useState(false);const[targetLang,setTargetLang]=useState('hi');const[liked,setLiked]=useState(false);const[bookmarked,setBookmarked]=useState(false);const[comments,setComments]=useState([]);const[commentText,setCommentText]=useState('');const[commentLoading,setCommentLoading]=useState(false);const[refresh,setRefresh]=useState(false);const token=localStorage.getItem('token');useEffect(()=>{var _article$source;if(!article)return;// Add to external reading history\nconst url=article.url||article.link;if(!url||typeof url!=='string'||!url.startsWith('http'))return;axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/user/external-history\"),{url,title:article.title,imageUrl:article.image_url||article.imageUrl||article.urlToImage,source:(_article$source=article.source)===null||_article$source===void 0?void 0:_article$source.name},{headers:{'x-auth-token':token}});// Fetch like/bookmark status\naxios.get(\"\".concat(process.env.REACT_APP_API_URL,\"/api/user/profile\"),{headers:{'x-auth-token':token}}).then(res=>{var _res$data$externalLik,_res$data$externalBoo;setLiked((_res$data$externalLik=res.data.externalLikes)===null||_res$data$externalLik===void 0?void 0:_res$data$externalLik.includes(url));setBookmarked((_res$data$externalBoo=res.data.externalBookmarks)===null||_res$data$externalBoo===void 0?void 0:_res$data$externalBoo.includes(url));});// Fetch comments\naxios.get(\"\".concat(process.env.REACT_APP_API_URL,\"/api/news/external/comments\"),{params:{url},headers:{'x-auth-token':token}}).then(res=>setComments(res.data));},[article,refresh,token]);if(!article){return/*#__PURE__*/_jsx(\"div\",{className:\"modern-bg min-h-screen flex flex-col items-center justify-center py-12 px-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl shadow-2xl p-10 border border-gray-100 text-center\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900 mb-4\",children:\"Article not found\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate(-1),className:\"mt-4 inline-flex items-center px-4 py-2 border border-transparent text-base font-semibold rounded-lg text-white bg-primary-600 hover:bg-primary-700\",children:\"Go Back\"})]})});}const displayDate=article.publishedAt&&!isNaN(new Date(article.publishedAt))?new Date(article.publishedAt).toLocaleDateString():null;const displayContent=article.description||(article.content&&!article.content.includes('[+')?article.content:'');const isContentTruncated=article.content&&article.content.includes('[+');const originalUrl=article.link||article.url;// --- Handlers ---\nconst handleLike=async()=>{try{if(liked){await axios.delete(\"\".concat(process.env.REACT_APP_API_URL,\"/api/news/external/like\"),{data:{url:article.url||article.link},headers:{'x-auth-token':token}});setLiked(false);}else{await axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/news/external/like\"),{url:article.url||article.link},{headers:{'x-auth-token':token}});setLiked(true);}}catch(err){toast.error('Failed to update like');}};const handleBookmark=async()=>{try{if(bookmarked){await axios.delete(\"\".concat(process.env.REACT_APP_API_URL,\"/api/news/external/bookmark\"),{data:{url:article.url||article.link},headers:{'x-auth-token':token}});setBookmarked(false);}else{await axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/news/external/bookmark\"),{url:article.url||article.link},{headers:{'x-auth-token':token}});setBookmarked(true);}}catch(err){toast.error('Failed to update bookmark');}};const handleAskAI=async e=>{e.preventDefault();if(!question.trim())return;setAiLoading(true);setAnswer('');try{var _res$data$candidates,_res$data$candidates$,_res$data$candidates$2,_res$data$candidates$3,_res$data$candidates$4;const res=await axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/ai/qa\"),{question,context:displayContent},{headers:{'x-auth-token':token}});setAnswer(res.data.answer||((_res$data$candidates=res.data.candidates)===null||_res$data$candidates===void 0?void 0:(_res$data$candidates$=_res$data$candidates[0])===null||_res$data$candidates$===void 0?void 0:(_res$data$candidates$2=_res$data$candidates$.content)===null||_res$data$candidates$2===void 0?void 0:(_res$data$candidates$3=_res$data$candidates$2.parts)===null||_res$data$candidates$3===void 0?void 0:(_res$data$candidates$4=_res$data$candidates$3[0])===null||_res$data$candidates$4===void 0?void 0:_res$data$candidates$4.text)||'');}catch(err){toast.error('AI failed');}finally{setAiLoading(false);}};const handleFactCheck=async()=>{setFactChecking(true);setFactCheckResult(null);try{const res=await axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/ai/fact-check\"),{content:displayContent},{headers:{'x-auth-token':token}});setFactCheckResult(res.data);}catch(err){toast.error('Fact-check failed');}finally{setFactChecking(false);}};const handleTranslate=async()=>{setTranslating(true);setTranslated('');try{const res=await axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/ai/translate\"),{text:displayContent,targetLang},{headers:{'x-auth-token':token}});setTranslated(res.data.translation);}catch(err){toast.error('Translation failed');}finally{setTranslating(false);}};const handleAddComment=async e=>{e.preventDefault();if(!commentText.trim())return;setCommentLoading(true);const url=article.url||article.link;if(!url||typeof url!=='string'||!url.startsWith('http')){toast.error('No valid URL for this article.');setCommentLoading(false);return;}try{await axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/news/external/comment\"),{url,content:commentText},{headers:{'x-auth-token':token}});setCommentText('');setRefresh(r=>!r);}catch(err){toast.error('Failed to add comment');}finally{setCommentLoading(false);}};return/*#__PURE__*/_jsx(\"div\",{className:\"modern-bg min-h-screen py-8\",children:/*#__PURE__*/_jsx(\"div\",{className:\"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl shadow-2xl p-8 sm:p-10 border border-gray-100\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>navigate(-1),className:\"inline-flex items-center text-gray-600 hover:text-primary-700 mb-6 font-semibold\",children:[/*#__PURE__*/_jsx(ArrowLeftIcon,{className:\"h-5 w-5 mr-2\"}),\"Back\"]}),(article.image_url||article.imageUrl||article.urlToImage)&&/*#__PURE__*/_jsx(\"img\",{src:article.image_url||article.imageUrl||article.urlToImage,alt:article.title,className:\"w-full h-auto max-h-80 object-cover rounded-xl mb-6 shadow-lg\"}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-extrabold text-primary-700 mb-4 tracking-tight drop-shadow\",children:article.title}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap items-center justify-between gap-y-2 mb-6 text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"inline-flex items-center px-3 py-1 rounded-full font-semibold bg-primary-100 text-primary-800\",children:((_article$source2=article.source)===null||_article$source2===void 0?void 0:_article$source2.name)||'External Source'}),displayDate&&/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:displayDate})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-1\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleLike,className:\"p-2 rounded-full \".concat(liked?'text-red-500 bg-red-100':'text-gray-400 hover:bg-gray-100',\" transition-colors\"),title:liked?'Unlike':'Like',children:/*#__PURE__*/_jsx(HeartIcon,{className:\"h-6 w-6\"})}),/*#__PURE__*/_jsx(\"button\",{onClick:handleBookmark,className:\"p-2 rounded-full \".concat(bookmarked?'text-blue-600 bg-blue-100':'text-gray-400 hover:bg-gray-100',\" transition-colors\"),title:bookmarked?'Unbookmark':'Bookmark',children:/*#__PURE__*/_jsx(BookmarkIcon,{className:\"h-6 w-6\"})})]})]}),displayContent&&/*#__PURE__*/_jsx(\"div\",{className:\"prose prose-lg max-w-none text-gray-800 mb-6\",children:/*#__PURE__*/_jsx(\"p\",{children:displayContent})}),isContentTruncated&&/*#__PURE__*/_jsxs(\"div\",{className:\"my-6 p-4 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 rounded-r-lg\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-bold\",children:\"Full content is not available here.\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm\",children:\"This is a preview. The complete article is on the original publisher's website.\"})]}),originalUrl&&/*#__PURE__*/_jsx(\"div\",{className:\"my-6\",children:/*#__PURE__*/_jsxs(\"a\",{href:originalUrl,target:\"_blank\",rel:\"noopener noreferrer\",className:\"inline-flex items-center gap-2 px-5 py-3 rounded-lg bg-primary-600 text-white font-bold hover:bg-primary-700 shadow-md hover:shadow-lg transition-all transform hover:-translate-y-0.5\",children:[/*#__PURE__*/_jsx(GlobeAltIcon,{className:\"h-5 w-5\"}),\"Read Original Article\"]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-10 pt-8 border-t border-gray-200\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-8\",children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"text-xl font-bold text-primary-700 mb-4 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(ChatBubbleLeftEllipsisIcon,{className:\"h-6 w-6\"}),\" AI Assistant\"]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleAskAI,className:\"flex flex-col gap-3 mb-3\",children:[/*#__PURE__*/_jsx(\"textarea\",{className:\"rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500 w-full\",rows:2,value:question,onChange:e=>setQuestion(e.target.value),placeholder:\"Ask a question about this article...\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"px-4 py-2 rounded-md bg-primary-600 text-white font-medium hover:bg-primary-700 w-fit self-start\",disabled:aiLoading,children:aiLoading?'Asking...':'Ask AI'})]}),answer&&/*#__PURE__*/_jsx(\"div\",{className:\"prose prose-lg max-w-none bg-blue-50 rounded-lg p-4 text-blue-900 mb-4\",children:/*#__PURE__*/_jsx(ReactMarkdown,{children:answer})}),/*#__PURE__*/_jsx(\"button\",{onClick:handleFactCheck,className:\"px-4 py-2 rounded-md bg-green-100 text-green-800 font-semibold hover:bg-green-200 flex items-center gap-2\",disabled:factChecking,children:factChecking?'Fact-checking...':/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(CheckBadgeIcon,{className:\"h-5 w-5\"}),\" Fact-Check\"]})}),factCheckResult&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 bg-gray-50 rounded-lg p-4 border border-gray-200\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-bold text-gray-800 mb-2\",children:\"Fact-Check Result\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold text-gray-700\",children:\"Verdict: \"}),/*#__PURE__*/_jsx(\"span\",{className:\"px-2 py-1 text-sm font-bold rounded-full \".concat({\"Accurate\":\"bg-green-100 text-green-800\",\"Mostly Accurate\":\"bg-green-100 text-green-800\",\"Mixed\":\"bg-yellow-100 text-yellow-800\",\"Mostly Inaccurate\":\"bg-red-100 text-red-800\",\"Inaccurate\":\"bg-red-100 text-red-800\",\"Unverifiable\":\"bg-gray-100 text-gray-800\",\"Parsing Failed\":\"bg-red-100 text-red-800\"}[factCheckResult.verdict]||'bg-gray-100 text-gray-800'),children:factCheckResult.verdict})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-700 mb-4 italic\",children:[\"\\\"\",factCheckResult.summary,\"\\\"\"]}),factCheckResult.claims&&factCheckResult.claims.length>0&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-bold text-gray-700 mb-2\",children:\"Detailed Claims Analysis:\"}),/*#__PURE__*/_jsx(\"ul\",{className:\"space-y-3\",children:factCheckResult.claims.map((item,index)=>/*#__PURE__*/_jsxs(\"li\",{className:\"border-l-4 p-3 rounded-r-lg \".concat({\"Accurate\":\"border-green-500 bg-green-50\",\"Inaccurate\":\"border-red-500 bg-red-50\",\"Unverifiable\":\"border-gray-400 bg-gray-100\",\"Error\":\"border-red-500 bg-red-50\"}[item.verdict]||'border-gray-400 bg-gray-100'),children:[/*#__PURE__*/_jsxs(\"p\",{className:\"font-semibold text-gray-800\",children:[\"Claim: \",/*#__PURE__*/_jsxs(\"span\",{className:\"font-normal\",children:[\"\\\"\",item.claim,\"\\\"\"]})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-700 mt-1\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Evaluation:\"}),\" \",item.evaluation]})]},index))})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-8\",children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"text-xl font-bold text-primary-700 mb-4 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(GlobeAltIcon,{className:\"h-6 w-6\"}),\" Translate\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2 mb-3\",children:[/*#__PURE__*/_jsxs(\"select\",{value:targetLang,onChange:e=>setTargetLang(e.target.value),className:\"rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"hi\",children:\"Hindi\"}),/*#__PURE__*/_jsx(\"option\",{value:\"es\",children:\"Spanish\"}),/*#__PURE__*/_jsx(\"option\",{value:\"fr\",children:\"French\"}),/*#__PURE__*/_jsx(\"option\",{value:\"zh\",children:\"Chinese\"}),/*#__PURE__*/_jsx(\"option\",{value:\"de\",children:\"German\"}),/*#__PURE__*/_jsx(\"option\",{value:\"ar\",children:\"Arabic\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleTranslate,className:\"px-4 py-2 rounded-md bg-primary-600 text-white font-medium hover:bg-primary-700\",disabled:translating,children:translating?'Translating...':'Translate'})]}),translated&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-yellow-50 rounded-lg p-4 text-yellow-900 whitespace-pre-line\",children:translated})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"text-xl font-bold text-primary-700 mb-4 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(ChatBubbleLeftEllipsisIcon,{className:\"h-6 w-6\"}),\" Comments\"]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleAddComment,className:\"flex gap-2 mb-4\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:commentText,onChange:e=>setCommentText(e.target.value),className:\"flex-1 rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500\",placeholder:\"Add a comment...\",disabled:commentLoading}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"px-4 py-2 rounded-md bg-primary-600 text-white font-medium hover:bg-primary-700\",disabled:commentLoading||!commentText.trim(),children:commentLoading?'Posting...':'Post'})]}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:comments.length===0?/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-500\",children:\"No comments yet.\"}):comments.map((c,idx)=>{var _c$user,_c$user2,_c$user2$name,_c$user2$name$,_c$user3;return/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start gap-3 bg-gray-50 rounded-xl p-4 shadow-sm\",children:[(_c$user=c.user)!==null&&_c$user!==void 0&&_c$user.profilePicture?/*#__PURE__*/_jsx(\"img\",{src:c.user.profilePicture,alt:\"profile\",className:\"h-10 w-10 rounded-full object-cover\"}):/*#__PURE__*/_jsx(\"span\",{className:\"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center text-gray-500 font-bold text-lg\",children:((_c$user2=c.user)===null||_c$user2===void 0?void 0:(_c$user2$name=_c$user2.name)===null||_c$user2$name===void 0?void 0:(_c$user2$name$=_c$user2$name[0])===null||_c$user2$name$===void 0?void 0:_c$user2$name$.toUpperCase())||'?'}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-bold text-gray-800 text-base\",children:((_c$user3=c.user)===null||_c$user3===void 0?void 0:_c$user3.name)||'User'}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs text-gray-400\",children:new Date(c.createdAt).toLocaleString()})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-700 mt-1\",children:c.content})]})]},idx);})})]})]})]})})});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}